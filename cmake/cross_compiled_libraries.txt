# TODO: improve (like dynamically download latest version)
include(ExternalProject)
ExternalProject_Add(PrecompiledLibraries
		    PREFIX precompiled
		    URL https://github.com/hioa-cs/IncludeOS/releases/download/v0.9.0/IncludeOS_install_v0-9-0.tar.gz
		    URL_HASH SHA1=8f7dfa92d38814c0c4f3e83adacfbd741a617622
		    CONFIGURE_COMMAND ""
		    BUILD_COMMAND ""
		    UPDATE_COMMAND ""
		    INSTALL_COMMAND ""
)

set(LIBCXX_INCLUDE_DIR ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/libcxx/include/)
set(LIBCXX_LIB_DIR ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/libcxx/)
add_library(libcxx STATIC IMPORTED)
set_target_properties(libcxx PROPERTIES IMPORTED_LOCATION ${LIBCXX_LIB_DIR}/libc++.a)

set(NEWLIB_INCLUDE_DIR ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/newlib/include/)
set(NEWLIB_LIB_DIR ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/newlib/)

set(LIBGCC_LIB_DIR ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/libgcc/)

add_library(libc STATIC IMPORTED)
set_target_properties(libc PROPERTIES IMPORTED_LOCATION ${NEWLIB_LIB_DIR}/libc.a)

add_library(libm STATIC IMPORTED)
set_target_properties(libm PROPERTIES IMPORTED_LOCATION ${NEWLIB_LIB_DIR}/libm.a)

add_library(libgcc STATIC IMPORTED)
set_target_properties(libgcc PROPERTIES IMPORTED_LOCATION ${LIBGCC_LIB_DIR}/libgcc.a)

set(CRTEND ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/crt/crtend.o)
set(CRTBEGIN ${CMAKE_CURRENT_BINARY_DIR}/precompiled/src/PrecompiledLibraries/crt/crtbegin.o)

install(DIRECTORY ${LIBCXX_INCLUDE_DIR} DESTINATION include/libcxx
	FILES_MATCHING PATTERN "*.h")

install(DIRECTORY ${NEWLIB_INCLUDE_DIR} DESTINATION include/newlib
	FILES_MATCHING PATTERN "*.h")
